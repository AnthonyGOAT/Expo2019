{"version":3,"sources":["commands/upload/AndroidUploader.js"],"names":["PLATFORM","FILE_DOESNT_EXIST_ERROR","path","SERVICE_ACCOUNT_JSON_QUESTION","name","message","type","validate","done","async","pathExists","then","exists","catch","err","AndroidUploader","projectDir","options","exp","has","Error","_getServiceAccountJSONPath","key","track","_askForServiceAccountJSONPath","answer","platformData","fastlane","androidPackage","_exp","android","package","supply_android"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AAEA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AACA;AAAA;AAAA;;;;AAEA,IAAMA,WAAW,SAAjB;;AAEA,IAAMC,0BAA0B,SAA1BA,uBAA0B;AAAA,mBAAgBC,IAAhB;AAAA,CAAhC;;AAEA,IAAMC,gCAAgC;AACpCC,QAAM,KAD8B;AAEpCC,WACE,yFAHkC;AAIpCC,QAAM,OAJ8B;AAKpCC,YAAU,SAASA,QAAT,CAAkBL,IAAlB,EAAwB;AAChC,QAAMM,OAAO,KAAKC,KAAL,EAAb;AACA,0CACGC,UADH,CACcR,IADd,EAEGS,IAFH,CAEQ,kBAAU;AACd,UAAIC,MAAJ,EAAY;AACVJ,aAAK,IAAL,EAAW,IAAX;AACD,OAFD,MAEO;AACLA,aAAKP,wBAAwBC,IAAxB,CAAL;AACD;AACF,KARH,EASGW,KATH,CASS;AAAA,aAAOL,KAAKM,GAAL,CAAP;AAAA,KATT;AAUD;AAjBmC,CAAtC;;IAoBqBC,e;;;AACnB,2BAAYC,UAAZ,EAAwBC,OAAxB,EAAiC;AAAA;AAAA,qNACzBjB,QADyB,EACfgB,UADe,EACHC,OADG;AAEhC;;;;6CAEwBC,G,EAAK;AAC5B,UAAI,CAAC,oCAAEC,GAAF,CAAMD,GAAN,EAAW,iBAAX,CAAL,EAAoC;AAClC,cAAM,IAAIE,KAAJ,CAAU,kDAAV,CAAN;AACD;AACF;;;;;;;;;;;uBAGmB,KAAKC,0BAAL,E;;;AAAZC,mB;iDACC,EAAEA,QAAF,EAAOC,OAAO,KAAKN,OAAL,CAAaM,KAA3B,E;;;;;;;;;;;;;;;;;;;;;;;;;AAICD,mB,GAAQ,KAAKL,O,CAAbK,G;+BACJA,G;;;;;;;;uBAAc,sCAAGZ,UAAH,CAAcY,GAAd,C;;;;;;;;;;;kDACTA,G;;;AAEP,oBAAIA,GAAJ,EAAS;AACP,qDAAIrB,wBAAwBqB,GAAxB,CAAJ;AACD;;uBACY,KAAKE,6BAAL,E;;;;;;;;;;;;;;;;;;;;;;;;;;;;;uBAKM,yCAAOrB,6BAAP,C;;;AAAfsB,sB;kDACCA,OAAOH,G;;;;;;;;;;;;;;;;;;;mKAGQI,Y,EAAcxB,I;;;;;;AAC5ByB,wB,GAAa,I,CAAbA,Q;AACAL,mB,GAAeI,Y,CAAfJ,G,EAAKC,K,GAAUG,Y,CAAVH,K;AACIK,8B,GAAmB,KAAKC,IAAL,CAAUC,O,CAAtCC,O;;uBACF,gDAAiBJ,SAASK,cAA1B,EAA0C,CAAC9B,IAAD,EAAO0B,cAAP,EAAuBN,GAAvB,EAA4BC,KAA5B,CAA1C,EAA8E,EAA9E,EAAkF,IAAlF,C;;;;;;;;;;;;;;;;;;;;kBArCWR,e","file":"../../../commands/upload/AndroidUploader.js","sourcesContent":["import _ from 'lodash';\nimport fs from 'fs-extra';\n\nimport BaseUploader from './BaseUploader';\nimport { runFastlaneAsync } from './utils';\nimport prompt from '../../prompt';\nimport log from '../../log';\n\nconst PLATFORM = 'android';\n\nconst FILE_DOESNT_EXIST_ERROR = path => `File ${path} doesn't exist.`;\n\nconst SERVICE_ACCOUNT_JSON_QUESTION = {\n  name: 'key',\n  message:\n    'The path to the file containing service account JSON, used to authenticate with Google:',\n  type: 'input',\n  validate: function validate(path) {\n    const done = this.async();\n    fs\n      .pathExists(path)\n      .then(exists => {\n        if (exists) {\n          done(null, true);\n        } else {\n          done(FILE_DOESNT_EXIST_ERROR(path));\n        }\n      })\n      .catch(err => done(err));\n  },\n};\n\nexport default class AndroidUploader extends BaseUploader {\n  constructor(projectDir, options) {\n    super(PLATFORM, projectDir, options);\n  }\n\n  _ensureExperienceIsValid(exp) {\n    if (!_.has(exp, 'android.package')) {\n      throw new Error('You must specify an Android package in app.json.');\n    }\n  }\n\n  async _getPlatformSpecificOptions() {\n    const key = await this._getServiceAccountJSONPath();\n    return { key, track: this.options.track };\n  }\n\n  async _getServiceAccountJSONPath() {\n    const { key } = this.options;\n    if (key && (await fs.pathExists(key))) {\n      return key;\n    } else {\n      if (key) {\n        log(FILE_DOESNT_EXIST_ERROR(key));\n      }\n      return await this._askForServiceAccountJSONPath();\n    }\n  }\n\n  async _askForServiceAccountJSONPath() {\n    const answer = await prompt(SERVICE_ACCOUNT_JSON_QUESTION);\n    return answer.key;\n  }\n\n  async _uploadToTheStore(platformData, path) {\n    const { fastlane } = this;\n    const { key, track } = platformData;\n    const { package: androidPackage } = this._exp.android;\n    await runFastlaneAsync(fastlane.supply_android, [path, androidPackage, key, track], {}, true);\n  }\n}\n"],"sourceRoot":"/expo-cli@2.4.0/src"}